{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container py-4">

    <h2 class="fw-bold">{{ contenido.titulo }}</h2>

    {% if contenido.descripcion %}
        <p class="text-muted">{{ contenido.descripcion }}</p>
    {% endif %}

    <hr>

    <!-- Tipo: Video (YouTube o URL externa) -->
    {% if contenido.tipo == 'video' and embed_url %}
    <div class="ratio ratio-16x9 mb-4">
        <iframe 
            src="{{ embed_url }}" 
            frameborder="0" 
            allowfullscreen
            referrerpolicy="strict-origin-when-cross-origin">
        </iframe>
    </div>
    {% endif %}

    <!-- Tipo: Imagen -->
    {% if contenido.tipo == 'imagen' and contenido.imagen %}
    <div class="text-center mb-4">
        <img src="{{ contenido.imagen.url }}" 
             alt="Imagen: {{ contenido.titulo }}" 
             class="img-fluid rounded shadow" 
             style="max-width: 800px;">
    </div>
    {% endif %}

    <!-- Tipo: PDF o archivo -->
    {% if contenido.tipo == 'pdf' and contenido.archivo %}
    <div class="mb-4 p-4 bg-light border rounded">
        <div class="d-flex align-items-center">
            <i class="bi bi-file-earmark-pdf text-danger fs-2 me-3"></i>
            <div>
                <strong>Documento PDF:</strong><br>
                <a href="{{ contenido.archivo.url }}" target="_blank" 
                   class="btn btn-danger btn-sm mt-2">
                    üì• Abrir / Descargar PDF
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Tipo: Texto / Explicaci√≥n -->
    {% if contenido.tipo == 'texto' %}
    <div class="mb-4 p-4 border-left border-primary rounded" style="border-left: 4px solid #0d6efd;">
        <p class="lead">{{ contenido.descripcion|safe }}</p>
    </div>
    {% endif %}

    <!-- Tipo: Quiz / Evaluaci√≥n -->
    {% if contenido.tipo == 'quiz' and preguntas %}
    <div class="mb-4">
        <h3 class="fw-bold mb-3">üìã Evaluaci√≥n</h3>
        
        {% if user.is_authenticated %}
        <form method="POST" action="{% url 'procesar_evaluacion' contenido.id %}" class="bg-light p-4 rounded">
            {% csrf_token %}
            
            {% for pregunta in preguntas %}
            <div class="mb-4 p-3 bg-white rounded border">
                <h5 class="fw-bold">Pregunta {{ forloop.counter }}: {{ pregunta.texto }}</h5>
                
                <div class="mt-3">
                    {% for opcion in pregunta.opciones.all %}
                    <div class="form-check">
                        <input 
                            class="form-check-input" 
                            type="radio" 
                            name="pregunta_{{ pregunta.id }}" 
                            id="opcion_{{ opcion.id }}"
                            value="{{ opcion.id }}"
                            required>
                        <label class="form-check-label" for="opcion_{{ opcion.id }}">
                            {{ opcion.texto }}
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
            
            <button type="submit" class="btn btn-success btn-lg w-100">
                ‚úì Enviar Evaluaci√≥n
            </button>
        </form>
        {% else %}
        <div class="alert alert-info">
            <strong>‚ö†Ô∏è Debes iniciar sesi√≥n:</strong> Para hacer la evaluaci√≥n necesitas 
            <a href="{% url 'login' %}" class="alert-link">iniciar sesi√≥n</a> primero.
        </div>
        
        <div class="bg-light p-4 rounded">
            {% for pregunta in preguntas %}
            <div class="mb-4 p-3 bg-white rounded border">
                <h5 class="fw-bold">Pregunta {{ forloop.counter }}: {{ pregunta.texto }}</h5>
                
                <div class="mt-3">
                    {% for opcion in pregunta.opciones.all %}
                    <div class="form-check">
                        <input 
                            class="form-check-input" 
                            type="radio" 
                            disabled>
                        <label class="form-check-label">
                            {{ opcion.texto }}
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% elif contenido.tipo == 'quiz' and not preguntas %}
    <div class="alert alert-warning">
        <strong>‚ö†Ô∏è Sin preguntas a√∫n:</strong> Esta evaluaci√≥n a√∫n no tiene preguntas disponibles.
    </div>
    {% endif %}

    <!-- Si no hay contenido espec√≠fico del tipo -->
    {% if not contenido.tipo|add:":text" and not embed_url and not contenido.archivo and not contenido.imagen %}
    <div class="alert alert-info">
        <strong>Contenido en desarrollo:</strong> Este contenido a√∫n no tiene detalles disponibles. Vuelve pronto.
    </div>
    {% endif %}

    <a href="{% url 'detalle_modulo' contenido.modulo.id %}" class="btn btn-secondary">
        ‚Üê Volver al m√≥dulo
    </a>

</div>

{% endblock %}
